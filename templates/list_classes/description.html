<!DOCTYPE html>
<html lang="en">
{% include 'lous_list/base.html' %}

<head>
    {% load static %}
    <meta charset="UTF-8">
    <title>{{ course.description }}</title>
    <link rel="stylesheet" href="{% static 'description.css' %}">
</head>
<body>
    <h1>Course Description</h1>
    {% if messages %}
        <ul class="messages">
            {% for message in messages %}
                {{ message }}
            {% endfor %}
        </ul>
    {% endif %}
    <h1>{{ course.subject }} {{ course.catalog_number }} - {{ course.description }}</h1>
    <form method="GET" onclick=goBack()>
        {% csrf_token %}
        <input type="button" value="Back">
    </form>
    <p><b>Units: </b>{{ course.units }}<br>
    <b>Type: </b>{{ course.component }}<br>
    <b>Days: </b>{{ course.meetings_days }}<br>
    <b>Time: </b>{{ course.meetings_start_time }} - {{ course.meetings_end_time }}<br>
    {% if course.secondary_meetings_days != "-" %}
        <b>Secondary Days: </b>{{ course.secondary_meetings_days }}<br>
        <b>Secondary Time: </b>{{ course.secondary_meetings_start_time }} - {{ course.secondary_meetings_end_time }}<br>
    {% endif %}
    <b>Instructor: </b>{{course.instructor_name}} ({{ course.instructor_email }})<br>
    <b>Location: </b>{{ course.meetings_facility_description }}<br>
    <b>Enrollment Availability: </b>{{ course.enrollment_total }}/{{ course.class_capacity }}<br>
    <b>Course Number: </b>{{ course.course_number }}<br>
    {% if user.is_authenticated %}
        <form method="POST" action={% url 'schedule:add_course' course_number=course.course_number %}>
            {% csrf_token %}
            <input type="submit" value="Add Course to Schedule">
        </form>
    {% endif %}
    <section>
    <hr>
    {% if component_list %}
        <h3>Available Components:</h3>
        <ul style="list-style:none">
            <form method="POST" action="#">
                <select id="select_component" onChange="update()">
                    {% for component in component_list %}
                        <option id="selected_component" value="
                                                        <b>Units: </b>{{ component.units }}<br>
                                                        <b>Type: </b>{{ component.component }}<br>
                                                        <b>Days: </b>{{ component.meetings_days }}<br>
                                                        <b>Time: </b>{{ component.meetings_start_time }} - {{ component.meetings_end_time }}<br>
                                                        <b>Instructor: </b>{{component.instructor_name}} ({{ component.instructor_email }})<br>
                                                        <b>Location: </b>{{component.meetings_facility_description}}<br>
                                                        <b>Enrollment Availability: </b>{{ component.enrollment_total }}/{{ component.class_capacity }}<br>
                                                        <b>Course Number: </b>{{ component.course_number }}">
                            {{component.meetings_days}} {{component.meetings_start_time}} - {{component.meetings_end_time}}</option>
                    {% endfor %}
                </select>
            </form>
            <p id="comp_header"></p>
            <script>
                function update() {
                    var select = document.getElementById('select_component');
                    var option = select.options[select.selectedIndex];
                    document.getElementById("comp_header").innerHTML = option.value;
                }
                update();
            </script>
        {% if user.is_authenticated %}
        <form method="POST" action="{% url 'schedule:add_course' course_number=12345 %}">
            {% csrf_token %}
            <input type="submit" value="Add Component to Schedule">
        </form>
        <script>
            function getComponentLink() {
                var text = document.getElementById("comp_header").textContent;
                var number = text.substring(text.length-6, text.length-1);
                return "{% url 'schedule:add_course' course_number=12345 %}".replace(/12345/, number);
            }
        </script>
        {% endif %}
        {% comment %}
            {% if component.secondary_meetings_days != "-" %}
                <p>Secondary Days: {{ course.secondary_meetings_days }}</p>
                <p>Secondary Time: {{ course.secondary_meetings_start_time }} - {{ course.secondary_meetings_end_time }}</p>
            {% endif %}
            {% if user.is_authenticated %}
                <form method="POST" action={% url 'schedule:add_course' course_number=component.course_number %}>
                    {% csrf_token %}
                    <input type="submit" value="Add Course to Schedule">
                </form>
            {% endif %}
        </ul>
        {% endcomment %}
    {% else %}
        <h3>No components are available for this course.</h3>
    {% endif %}
    </section>
    {% include 'comment/description.html' %}
</body>
<script>
    function goBack() {
        if(document.referrer.includes(window.location.host)){
            window.history.back();
        }
    }
</script>
</html>
